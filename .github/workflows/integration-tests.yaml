name: "Integration Tests"
on:
  workflow_call:

jobs:
  test-extract-tag:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Update action.yaml docker version
        uses: ValoriaTechnologia/FieldChartUpdater@v0.0.2
        with:
          file: ./action.yaml
          edits: '[{"path": "runs.image", "value": "Dockerfile"}]'

      - name: ExtractTag
        id: extract
        uses: ./

      - name: Verify TAG hash
        run: |
          expected=$(git rev-parse HEAD)
          echo "Expected: $expected"
          echo "TAG:      $TAG"
          if [ "$TAG" != "$expected" ]; then
            echo "::error::TAG mismatch: expected $expected, got $TAG"
            exit 1
          fi
          echo "::notice::TAG correctly set to $TAG"
